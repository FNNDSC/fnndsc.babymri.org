<link rel="import" href="../page/page.html">
<link rel="import" href="../people/people.html">

<link rel="import" href="../../lib-elements/paper-button/paper-button.html">
<link rel="import" href="../../lib-elements/paper-dialog/paper-dialog-transition.html">
<link rel="import" href="../../lib-elements/paper-dialog/paper-dialog.html">

<polymer-element name="live-element" extends="page-element">
  <template>

    <link rel="stylesheet" type="text/css" href="live.css" />

    <!-- Title -->
    <div class='pageTitle'>
      <div class="container">
        <div id="jumbo" class=" jumbotron" >
          <template if="{{(research == null) && (cache == null)}}">
            <span class="spinner"><img src="../../images/spinner.gif"></span>
          </template>
          <span class="small">We stream live</span>
          <span class="large {{name}}">events</span>
        </div>
      </div>
    </div>

    <div id="navnavContainer">
         <div id="navnav">
        <div class="row">
          <div class='container'>
            <ul class='navbar-nav nav'>
              <template if="{{structure != null}}">
                <template repeat="{{section in structure}}">
                  <li on-tap="{{gotoSection}}" class='nav-element'>
                    <a id='{{name}}-nav-{{section.index}}' class='{{name}}' data-section='{{section.index}}'>{{section.label}}</a>
                  </li>
                </template>
              </template>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Paper Dialog -->
    <paper-dialog heading="Abstract" transition="paper-dialog-transition-center" tabindex="-1" class="paper-dialog-transition paper-dialog-transition-center" style="z-index: 2000; position: fixed; display: none;">
      <content>

        <div id="abstract"></div>

      </content>

      <paper-button label="Close" affirmative default></paper-button>

    </paper-dialog>

    <!-- Content -->
    <div class="container">
      <div class="">
        <div class="col-md-12 col-lg-12">
          <div class="fBox">
            <section id="live" class='element'>

              <div class='row card'>

                <div id="liveSectionTitle" class="title {{name}}">Upcoming talks</div>
<div class='row'>
              <template if="{{live != null}}">
                <template repeat="{{event in live.feed.entry}}">
                  <template if="{{event.gsx$group.$t === 'next'}}">
                    <div>
                      <card-element cardObject="{{event}}" cardLoaded="{{eventLoaded}}" cardSelected="{{eventSelected}}"></card-element>
                    </div>
                  </template>
                </template>
              </template>
            </div>
            </div>
            </section>

            <section id="fnndsctalks" class='element'>

              <div class='row card'>

                <div id="prevTitle" class="title {{name}}">Fnndsc talks</div>
<div class='row'>
              <template if="{{live != null}}">
                <template repeat="{{event in live.feed.entry}}">
                  <template if="{{event.gsx$group.$t === 'fnndsctalk'}}">
                    <div>
<card-element cardObject="{{event}}" cardLoaded="{{eventLoaded}}" cardSelected="{{eventSelected}}"></card-element>
                    </div>
                  </template>
                </template>
              </template>
            </div>
            </div>
            </section>

            <section id="unix101" class='element'>

              <div class='row card'>

                <div id="prevTitle" class="title {{name}}">Unix 101 series</div>
                <div class='row'>
              <template if="{{live != null}}">
                <template repeat="{{event in live.feed.entry}}">
                  <template if="{{event.gsx$group.$t === 'unix101'}}">
                    <div>
<card-element cardObject="{{event}}" cardLoaded="{{eventLoaded}}" cardSelected="{{eventSelected}}"></card-element>
                    </div>
                  </template>
                </template>
              </template>
            </div>
            </div>
            </section>
          </div>
        </div>
      </div>
    </div>

    <template if="{{cache == null && attached == 1 }}">
      <polymer-jsonp auto url="https://spreadsheets.google.com/feeds/list/{{spreadsheet}}/od6/public/values?alt=json-in-script&callback=" response="{{live}}"></polymer-jsonp>
    </template>

  </template>

  <script>
    Polymer('live-element', {
      name: 'live',
      spreadsheet: '0Asu7h0aKnydhdHdNOUMxWVVvQkJlQUZvYTFQX0t5OXc',
      youtubeVideo: 'https://www.youtube.com/watch?v=',
      youtubeImage: 'http://img.youtube.com/vi',
      attached: function(){
        this.super();
        if(this.cache != null){
          this.live = this.cache;
        }
        this.attached = 1;
      },
      liveChanged: function(){
        if(this.live){

          // // format the object
          // <template repeat="{{people in team.feed.entry}}">
          //   <template if="{{people.gsx$group.$t === 'faculty'}}">
          //     <card-element cardObject="{{people}}" cardLoad
          // {{cardObject.gsx$title.$t}}
          // {{cardObject.gsx$art.$t}}
          // {{cardObject.gsx$date.$t}}
          // {{cardObject.gsx$category.$t}}
          // {{cardObject.gsx$l1.$t}}
          // {{cardObject.gsx$l2.$t}}
          // {{cardObject.gsx$l3.$t}}
          for(var i = 0; i < this.live.feed.entry.length; i++){
            // generate title if no title
            if(!this.live.feed.entry[i].gsx$title){
              this.live.feed.entry[i].gsx$title = {$t:''};
              this.live.feed.entry[i].gsx$title.$t = this.live.feed.entry[i].gsx$titlefull.$t.substring(0,30);
              if(this.live.feed.entry[i].gsx$titlefull.$t.length > 30){
                this.live.feed.entry[i].gsx$title.$t += '...';
              }
            }

            //generate picture if no
            if(!this.live.feed.entry[i].gsx$picture){
              this.live.feed.entry[i].gsx$picture = {$t:''};
              this.live.feed.entry[i].gsx$picture.$t = this.youtubeImage + '/' +this.live.feed.entry[i].gsx$videoid.$t + '/2.jpg';
            }

            //generate picturelink if no
            if(!this.live.feed.entry[i].gsx$picturelink){
              this.live.feed.entry[i].gsx$picturelink = {$t:''};
              this.live.feed.entry[i].gsx$picturelink.$t = this.youtubeVideo +this.live.feed.entry[i].gsx$videoid.$t;
            }

            // generate text for the lines
            if(!this.live.feed.entry[i].gsx$l1){
              this.live.feed.entry[i].gsx$l1 = {$t:''};
              this.live.feed.entry[i].gsx$l1.$t = this.live.feed.entry[i].gsx$speaker.$t;
            }
            if(!this.live.feed.entry[i].gsx$l2){
              this.live.feed.entry[i].gsx$l2 = {$t:''};
              this.live.feed.entry[i].gsx$l2.$t = this.live.feed.entry[i].gsx$showtime.$t;
            }
            if(!this.live.feed.entry[i].gsx$l3){
              this.live.feed.entry[i].gsx$l3 = {$t:''};
              this.live.feed.entry[i].gsx$l3.$t = this.live.feed.entry[i].gsx$event.$t;
            }
          }


          this.cache = this.live;
        }
      },
      eventSelectedChanged: function(){
        // update content of dialog
        if(this.eventSelected != null){
          this.$.abstract.innerHTML = this.eventSelected.gsx$abstract.$t;

          var dialog = this.shadowRoot.querySelector('paper-dialog');
          dialog.shadowRoot.querySelector('#main h1').innerHTML = this.eventSelected.gsx$titlefull.$t;
          dialog.toggle();

          this.eventSelected = null;
        }

      },
    });

  </script>
</polymer-element>
