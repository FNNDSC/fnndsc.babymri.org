<link rel="import" href="../page/page.html">

<polymer-element name="research-element" extends="page-element">
  <template>
    <link rel="stylesheet" href="research.css">

      <div class='pageTitle'>
        <div class="container">
          <div id="jumbo" class="jumbotron" >
            <template if="{{(research == null) && (cache == null)}}">
              <span class="spinner"><img src="../../images/spinner.gif"></span>
            </template>
            <span class="small">Our research addresses critical needs in the pediatric </span>
            <span class="large">population</span>
          </div>
        </div>
      </div>

      <div id="navnavContainer">
           <div id="navnav">
          <div class="row">
            <div class='container'>
              <ul class='navbar-nav nav'>
                <template if="{{structure != null}}">
                  <template repeat="{{section in structure}}">
                    <li on-tap="{{gotoSection}}" class='nav-element'>
                      <a id='{{name}}-nav-{{section.index}}' data-section='{{section.index}}'>{{section.label}}</a>
                    </li>
                  </template>
                </template>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="container">
      <div class="">
        <div class="col-md-12 col-lg-12">
        <div class="fBox">

        <section id="challenges" class="element">
          <!-- <div id="challengesTitle" class="title"></div> -->
          <div class='row card'>
            <div id="challengesTitle2" class="title"></div>

            <div id="owlchallenges" class="slider" style="z-index:10;">
            </div>
        </div>
          <div class='clear'></div>
        </section>

        <section id="mri" class="element">
          <!-- <div id="mriTitle" class="title"></div> -->
          <div class='row card'>
            <div id="mriTitle2" class="title"></div>
            <div id="owlmri" class="slider" style="z-index:10;">
        </div>
          <div class='clear'></div>
        </section>

        <section id="nirs" class="element">
          <!-- <div id="nirsTitle" class="title"></div> -->
          <div class='row card'>
            <div id="nirsTitle2" class="title"></div>
            <div id="owlnirs" class="slider" style="z-index:10;">
        </div>
          <div class='clear'></div>
        </section>

        <section id="meg" class="element">
          <!-- <div id="megTitle" class="title"></div> -->
          <div class='row card'>
            <div id="megTitle2" class="title"></div>
            <div id="owlmeg" class="slider" style="z-index:10;">
        </div>
          <div class='clear'></div>
        </section>

    </div>
    </div>

    </div>
    </div>

    <footer-element></footer-element>

    <template if="{{cache == null && attached == 1 }}">
        <polymer-jsonp auto url="https://spreadsheets.google.com/feeds/list/{{spreadsheet}}/od6/public/values?alt=json-in-script&callback=" response="{{research}}"></polymer-jsonp>
    </template>

  </template>

  <script>
    Polymer('research-element', {
      name: 'research',
      spreadsheet: '0Asu7h0aKnydhdEpPMXFFNFVTU1E5ZXFJSGZjbVJTOGc',
      attached: function(){
        this.super();
        var self = this;
        if(this.cache != null){
          this.research = this.cache;
        }

        this.attached = 1;
      },
      researchChanged: function() {
        if(this.research){
          // titles
          // this.$.challengesTitle.innerHTML = this.research.feed.entry[0].gsx$challenges.$t;
          // this.$.mriTitle.innerHTML = this.research.feed.entry[0].gsx$mri.$t;
          // this.$.nirsTitle.innerHTML = this.research.feed.entry[0].gsx$nirs.$t;
          // this.$.megTitle.innerHTML = this.research.feed.entry[0].gsx$meg.$t;
          // titles2
          this.$.challengesTitle2.innerHTML = this.research.feed.entry[0].gsx$challenges.$t;
          this.$.mriTitle2.innerHTML = this.research.feed.entry[0].gsx$mri.$t;
          this.$.nirsTitle2.innerHTML = this.research.feed.entry[0].gsx$nirs.$t;
          this.$.megTitle2.innerHTML = this.research.feed.entry[0].gsx$meg.$t;
          // contents
          this.owlify('challenges');
          this.owlify('mri');
          this.owlify('nirs');
          this.owlify('meg');

          this.cache = this.research;
        }
      },
      owlify: function(target ){
        var str = this.research.feed.entry[1]['gsx$'+target].$t.trim();
        var res = str.split("</p>");
        var els = '';
        for(var i = 0; i< res.length; i++){
          if(res[i] !== ""){
          els += '<div class="item content">' + res[i] + '</p></div>';
        }
        }
        this.$['owl'+target].innerHTML = els;
        var owlDemo0 = this.shadowRoot.querySelector('#owl'+target);
        $(owlDemo0).owlCarousel({
            singleItem:true,
            navigation:true
          });
      }
    });

  </script>
</polymer-element>
